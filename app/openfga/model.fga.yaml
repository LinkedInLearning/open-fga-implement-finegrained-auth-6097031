model: |
  model 
  schema 1.1

  type user

  type organization
    relations
      define admin: [user]
      define member: [user]
      define viewer: [user]

      define can_add_member: admin
      define can_delete_member: admin
      define can_view_member: admin or member
      define can_add_document: admin or member

  type document
    relations
      define organization: [organization]
      
      # Roles específicos del documento
      define owner: [user]
      define editor: [user]
      define viewer: [user]

      # Permisos que combinan roles organizacionales Y específicos del documento
      define can_read: viewer or editor or owner or member from organization or admin from organization
      define can_write: editor or owner or admin from organization
      define can_delete: owner or admin from organization      

tuples:
  - user: user:alice
    relation: admin
    object: organization:tech-company
  - user: user:bob
    relation: member
    object: organization:tech-company
  - user: user:charlie
    relation: viewer
    object: organization:tech-company
  - user: user:diana
    relation: member
    object: organization:marketing-dept
  - user: organization:tech-company
    relation: organization
    object: document:technical-specs
  - user: organization:tech-company
    relation: organization
    object: document:company-handbook
  - user: organization:marketing-dept
    relation: organization
    object: document:marketing-plan
  - user: user:alice
    relation: owner
    object: document:personal-notes
  - user: organization:tech-company
    relation: organization
    object: document:personal-notes
  - user: user:bob
    relation: owner
    object: document:project-plan
  - user: user:charlie
    relation: editor
    object: document:project-plan
  - user: user:alice
    relation: owner
    object: document:confidential-report
  - user: user:bob
    relation: viewer
    object: document:confidential-report
  - user: user:bob
    relation: owner
    object: document:company-handbook
  - user: user:charlie
    relation: viewer
    object: document:company-handbook

tests:
  - check:
    # Permisos por roles organizacionales:
    - user: user:alice
      object: document:company-handbook
      assertions:
        can_read: true
    - user: user:bob
      object: document:technical-specs
      assertions:
        can_write: false
        can_read: true
    - user: user:charlie
      object: document:company-handbook
      assertions:
        can_write: false 
    - user: user:diana
      object: document:company-handbook
      assertions:
        can_read: false
    # Permisos por propiedad individual:
    - user: user:alice
      object: document:personal-notes
      assertions:
        can_read: true
        can_write: true
        can_delete: true
    - user: user:bob
      object: document:personal-notes
      assertions:
        can_read: true # because member of organization
        can_write: false
    - user: user:charlie
      object: document:personal-notes
      assertions:
        can_read: false # not a member of the organization
        can_write: false
    # Permisos organizacionales:
    - user: user:alice
      object: organization:tech-company
      assertions:
        can_add_member: true
    - user: user:bob
      object: organization:tech-company
      assertions:
        can_add_member: false
    - user: user:bob
      object: organization:tech-company
      assertions:
        can_view_member: true
    - user: user:bob
      object: document:project-plan
      assertions:
        owner: true
    - user: user:charlie
      object: document:project-plan
      assertions:
        editor: true
    - user: user:alice
      object: document:confidential-report
      assertions:
        owner: true
    - user: user:bob
      object: document:confidential-report
      assertions:
        viewer: true
    - user: user:bob
      object: document:company-handbook
      assertions:
        owner: true
    - user: user:charlie
      object: document:company-handbook
      assertions: 
        viewer: true
